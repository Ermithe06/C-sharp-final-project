<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    x:Class="Maui.Charting.Views.PatientsPage"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:vm="clr-namespace:Maui.Charting.ViewModels"
    xmlns:conv="clr-namespace:Maui.Charting.Converters">

    <!-- 🔥 Add Converter Resource -->
    <ContentPage.Resources>
        <conv:AgeColorConverter x:Key="AgeColorConverter" />
    </ContentPage.Resources>

    <ScrollView>
        <VerticalStackLayout Padding="12" Spacing="12">

            <!-- HEADER -->
            <Label Text="Patients"
                   FontSize="24"
                   FontAttributes="Bold"
                   HorizontalOptions="Center" />

            <!-- INLINE ADD FORM -->
            <Frame BorderColor="Gray" Padding="10">
                <VerticalStackLayout Spacing="6">
                    <Label Text="Add Patient" FontAttributes="Bold" />

                    <Entry Placeholder="First Name" Text="{Binding NewFirstName}" />
                    <Entry Placeholder="Last Name" Text="{Binding NewLastName}" />
                    <Entry Placeholder="Address" Text="{Binding NewAddress}" />

                    <DatePicker Date="{Binding NewBirthDate}" />

                    <Entry Placeholder="Race" Text="{Binding NewRace}" />

                    <!-- Gender Picker -->
                    <Picker Title="Gender"
                            ItemsSource="{Binding GenderOptions}"
                            SelectedItem="{Binding NewGender}" />

                    <Button Text="Add Patient"
                            Command="{Binding AddCommand}" />
                </VerticalStackLayout>
            </Frame>

            <!-- PATIENT LIST -->
            <CollectionView ItemsSource="{Binding Patients}">
                <CollectionView.ItemTemplate>
                    <DataTemplate>
                        <!-- 🔥 Highlight minors using background color -->
                        <Frame Padding="10"
                               Margin="0,5"
                               BorderColor="LightGray"
                               BackgroundColor="{Binding ., Converter={StaticResource AgeColorConverter}}">

                            <Grid ColumnDefinitions="3*,Auto,Auto" ColumnSpacing="10">

                                <!-- Patient Info -->
                                <VerticalStackLayout Grid.Column="0">
                                    <Label Text="{Binding FullName}"
                                           FontAttributes="Bold" />
                                    <Label Text="{Binding BirthDate, StringFormat='Born: {0:yyyy-MM-dd}'}" />
                                    <Label Text="{Binding Gender}" />
                                </VerticalStackLayout>

                                <!-- Edit Button -->
                                <Button Grid.Column="1"
                                        Text="Edit"
                                        Command="{Binding Source={RelativeSource AncestorType={x:Type vm:PatientsViewModel}}, Path=EditCommand}"
                                        CommandParameter="{Binding}" />

                                <!-- Delete Button -->
                                <Button Grid.Column="2"
                                        Text="Delete"
                                        BackgroundColor="Red"
                                        TextColor="White"
                                        Command="{Binding Source={RelativeSource AncestorType={x:Type vm:PatientsViewModel}}, Path=DeleteCommand}"
                                        CommandParameter="{Binding}" />
                            </Grid>

                        </Frame>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>

        </VerticalStackLayout>
    </ScrollView>

</ContentPage>
